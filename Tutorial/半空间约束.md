## 输入信息

- `Lidar` 
```shell
# Single scan from a planar laser range-finder
#
# If you have another ranging device with different behavior (e.g. a sonar
# array), please find or create a different message, since applications
# will make fairly laser-specific assumptions about this data

Header header            # timestamp in the header is the acquisition time of 
                         # the first ray in the scan.
                         #
                         # in frame frame_id, angles are measured around 
                         # the positive Z axis (counterclockwise, if Z is up)
                         # with zero angle being forward along the x axis
                         
float32 angle_min        # start angle of the scan [rad]
float32 angle_max        # end angle of the scan [rad]
float32 angle_increment  # angular distance between measurements [rad]

float32 time_increment   # time between measurements [seconds] - if your scanner
                         # is moving, this will be used in interpolating position
                         # of 3d points
float32 scan_time        # time between scans [seconds]

float32 range_min        # minimum range value [m]
float32 range_max        # maximum range value [m]

float32[] ranges         # range data [m] (Note: values < range_min or > range_max should be discarded)
float32[] intensities    # intensity data [device-specific units].  If your
                         # device does not provide intensities, please leave
                         # the array empty.

```

- 位姿 $[x,y,\theta]^T$

## 转换核心原理
2D点云转换为半空间约束的核心逻辑是：**以“位姿中心点→最近点”的向量为约束法向量，以最近点为约束边界线的过点，生成包含中心点的半空间区域**。


### 半空间约束的数学本质
在2D空间中，半空间约束由“**约束边界线**”和“**有效区域**”两部分组成：
1. **约束边界线**：一条无限长直线，是半空间的“分界线”，数学方程为 $a \cdot x + b \cdot y + c = 0$，其中 $[a,b]$ 是直线的**法向量**（垂直于边界线，指向有效区域）。
2. **有效半空间**：满足 $a \cdot x + b \cdot y + c \geq 0$ 的所有点组成的区域（本文案例中，有效区域包含位姿中心点）。


### 约束参数的关键推导（核心步骤）
半空间约束的核心是确定3个参数：**法向量 $[a,b]$、边界线过点 $P_{\text{closest}}$、常数项 $c$**。推导过程完全依赖“位姿中心点”与“最近点”的几何关系，具体步骤如下：

#### 步骤1：定义基础几何量
设：
- 位姿中心点（可变化）的全局坐标为 $O = [x_o, y_o]$；
- 点云中离 $O$ 最近的点（最近点）为 $P_{\text{closest}} = [x_c, y_c]$；
- 向量 $\vec{OP} = P_{\text{closest}} - O = [x_c - x_o, y_c - y_o]$（从中心点指向最近点）。


#### 步骤2：确定约束边界线的法向量 $[a,b]$
半空间约束的核心需求是：**约束边界线需“紧贴最近点”，且有效区域包含中心点**。  
为满足该需求，约束边界线的法向量需与 $\vec{PO}$（从最近点指向中心点的向量）方向一致，即：
$$
[a,b] = \vec{PO} = O - P_{\text{closest}} = [x_o - x_c, y_o - y_c]
$$
- 数学意义：法向量 $[a,b]$ 指向中心点，确保有效区域（$a x + b y + c \geq 0$）包含中心点；
- 归一化处理：为避免向量长度影响约束计算，需对 $[a,b]$ 归一化（代码中通过 $\text{norm} = \sqrt{a^2 + b^2}$ 实现）：
  $$
  [a_{\text{norm}}, b_{\text{norm}}] = \frac{[a,b]}{\text{norm}} \quad (\text{norm} \neq 0)
  $$


#### 步骤3：确定约束边界线的方程
约束边界线需“过最近点 $P_{\text{closest}}$”且“法向量为 $[a,b]$”，根据直线的点法式方程推导：
1. 点法式方程：$a(x - x_c) + b(y - y_c) = 0$（直线过点 $[x_c,y_c]$，法向量为 $[a,b]$）；
2. 展开为标准形式：$a x + b y - (a x_c + b y_c) = 0$，即常数项 $c = - (a x_c + b y_c)$；
3. 最终约束边界线方程：$a x + b y - (a x_c + b y_c) = 0$；
4. 有效半空间条件：$a x + b y - (a x_c + b y_c) \geq 0$（代入中心点 $O$ 验证：$a x_o + b y_o - (a x_c + b y_c) = a(x_o - x_c) + b(y_o - y_c) = a^2 + b^2 \geq 0$，满足约束，确保有效区域包含 $O$）。



## 完整转换流程（从点云到约束）
结合本文交互式案例，2D点云转换为半空间约束的完整流程分为**4个阶段**，每个阶段对应明确的数学操作和代码函数：

### 阶段1：最近点检测（找到点云中离当前中心最近的点）
目标：从点云中筛选出对约束最关键的点（最近点），因为半空间约束需紧贴“离中心最近的点”以确保约束有效性。  
#### 数学操作：
1. 计算每个点到当前中心 $O = [x_o, y_o]$ 的欧式距离：  
   $$
   d_i = \sqrt{(x_i - x_o)^2 + (y_i - y_o)^2}
   $$
2. 找到最小距离对应的点：$P_{\text{closest}} = [x_i, y_i] \quad (\text{where } i = \arg\min(d_i))$。


### 阶段2：半空间约束计算（生成约束边界与有效区域）
目标：基于“当前中心→最近点”的几何关系，计算约束边界线和有效半空间的参数。  
#### 数学操作（对应3.2节推导）：
1. 计算法向量：$[a,b] = [x_o - x_c, y_o - y_c]$，归一化后为 $[a_{\text{norm}}, b_{\text{norm}}]$；
2. 计算约束边界线端点：$P_1 = [x_c - b_{\text{norm}} \cdot \text{extend}, y_c + a_{\text{norm}} \cdot \text{extend}]$，$P_2 = [x_c + b_{\text{norm}} \cdot \text{extend}, y_c - a_{\text{norm}} \cdot \text{extend}]$；
3. 计算半空间多边形顶点：$P_3 = P_2 + [a_{\text{norm}} \cdot \text{extend}, b_{\text{norm}} \cdot \text{extend}]$，$P_4 = P_1 + [a_{\text{norm}} \cdot \text{extend}, b_{\text{norm}} \cdot \text{extend}]$。
