# MPC

## 运动学模型

平面坐标下可用 $x=[x,y,\theta]$ 描述状态
- $x,y$ 为车辆相对全局坐标系位置
- $\theta$ 车辆方位角(车辆朝向与全局水平轴的夹角)

控制输入 $u=[v,\omega]$ 
-  $v$ 为车辆朝向方向的线速度
- $\omega$ 为相对车辆坐标系自身旋转角速度

运动学模型描述为

$$
\begin{align}
\dot{x}&=vcos\theta\\
\dot{y}&=vsin\theta\\
\dot{\theta}&=\omega\\
\end{align}
$$

矩阵形式为

$$
\dot{x}=
\left[
\begin{matrix}
cos\theta & 0\\
sin\theta  & 0\\
0 & 1
\end{matrix}
\right]
\left[
\begin{matrix}
v \\
\omega \\
\end{matrix}
\right]
$$

简写为

$$
\dot{x}=f(x,u)
$$

离散为差分方程形式


$$
x(k+1)=x(k)+\Delta T
\left[
\begin{matrix}
cos\theta(k)v(k)\\
sin\theta(k)v(k)\\
\omega(k)
\end{matrix}
\right]
$$

$\Delta T$ 为$k+1$和$k$时刻时间差。

## (Optimal Control Problem)OCP问题

首先考虑连续系统，给定以下条件

- $\mathrm{x_s},\mathrm{x_f}$ 为起始状态和终止状态
- $t_s,t_f$ 起始时间和终止状态

对于 $t$ 时刻的各个状态和运动学方程可表示为

$$
\begin{align}
&\mathrm{x(t)}\\
&\mathrm{u(t)}\\
&\dot{\mathrm{x}}(t)=f\big(\mathrm{x(t)},\mathrm{u(t)}\big)
\end{align}
$$


优化的目的是通过控制输入，使车辆从起始状态逼近目标状态

而且期望这个过程中产生的所有$u$和$x$均遵守约束，

OCP问题可描述为

$$
\begin{align}
&\underset {\mathrm{u}(t),\mathrm{u}(t),t_f}{min} J_f\big(\mathrm{x(t_f)}\big)+\int_{t=t_s}^{t_f} l\big(\mathrm{x}(t),\mathrm{u}(t)\big)dt\\
&\mathrm{subject~to}\\
&\qquad \mathrm{x}(t_s)=\mathrm{x}_s,\quad\mathrm{x}(t_f)=\mathrm{x}_f\\
&\qquad \dot{\mathrm{x}}(t)=f\big(\mathrm{x(t)},\mathrm{u(t)}\big)\\
&\qquad \mathrm{u(t)}\in \mathrm{U}, \quad t_f\in T
\end{align}
$$

- $\mathrm{U}$ 为控制变量可行集合
- $T$ 为时间约束