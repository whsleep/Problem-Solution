# 符号框架

## SX

在 CasADi 中，SX（Scalar eXpression，标量表达式）是一种符号变量类型，是构建符号计算的基础单元，主要作用是帮助用户以 “符号化” 的方式定义数学表达式（如目标函数、约束条件、动态系统方程等），并支持自动微分（求导）、代码生成等核心功能。

### 定义方式

```python
from casadi import *

# 1x1 符号矩阵
x = SX.sym("x")
print(x)
# 1x5 符号矩阵
y = SX.sym("y", 5)
print(y)
# 4x2 符号矩阵
z = SX.sym("z", 4, 2)
print(z)
# 符号数学表达式
f = x*x + 3/x
print(f)
# 全零密集 4x5 矩阵
zer = SX.zeros(4, 5)
# 稀疏空矩阵 4x5 矩阵
spar = SX(4, 5)
print(spar)
# 稀疏 4x4 矩阵
e = SX.eye(4)
print(e)
```

**一些补充**

- `SX.sym(name,n,m)`: 创建名称为 `name` 的 `nxm` 矩阵

- `SX.zeros(n,m)`: 创建 `n×m` 维度的稠密零矩阵

- `SX(n,m)`: 创建 `n×m` 维度的结构零矩阵（仅在 “结构上” 标记为零，未存储具体数值，属于稀疏矩阵特性）

- `SX.ones(n,m)`: 创建 `n×m` 维度的稠密全 1 矩阵（所有元素均为数值 1，矩阵类型为 SX）

- `SX.eye(n)`: 创建 `n×n` 维度的单位矩阵（主对角线上的元素为 1，其余位置为结构零）

- `SX(scalar_type)`: 创建 `1×1` 的标量 `SX` 矩阵（即符号标量）

    参数 `scalar_type` 为具体数值，可显式或隐式调用，用于将普通数值转换为 SX 类型（以适配符号表达式运算）。

    **显式示例**：将数值 9 转换为 SX 标量
    `s = ca.SX(9)`

    **隐式示例**：通过数值与 SX 矩阵的运算自动转换
    `mat = 9 * ca.SX.ones(2, 2)`

- `SX(matrix_type)`: 将外部数值矩阵（如 NumPy 矩阵、SciPy 矩阵，Python 环境下；或 MATLAB/Octave 中的稠密 / 稀疏矩阵）转换为 SX 类型矩阵，实现 “数值矩阵→符号矩阵” 的格式兼容。

- `repmat(v,n,m)`: 对 SX 表达式 v 进行 “重复扩展”，纵向（垂直方向）重复 n 次，横向（水平方向）重复 m 次，生成新的 SX 矩阵，用于快速构建具有重复结构的符号矩阵。

    `repeated_vec = ca.repmat(ca.SX(3), 2, 1)` 结果为 `[3;3]`


## MX

在 CasADi 中，MX（Matrix eXpression，矩阵表达式）是另一种符号变量类型，与 SX 类似但设计目标不同：MX 更擅长处理矩阵级别的符号运算，尤其适合高维、稀疏或包含复杂矩阵操作（如线性代数运算、函数嵌套）的场景，是构建大型符号计算问题的核心工具。

### 符号函数

```python
from casadi import *

# 创建2×3和3×2的MX矩阵（符号变量）
A = MX.sym('A', 2, 3)  # 2行3列的MX符号矩阵
B = MX.sym('B', 3, 2)  # 3行2列的MX符号矩阵

# 矩阵乘法（结果为2×2的MX矩阵）
C = A @ B  

# 提取C的第1行（子矩阵操作）
C_row = C[0, :]  

# 定义第一个函数：f(x) = x²（输入输出均为MX类型）
x = MX.sym('x')
f = Function('f', [x], [x**2])
print(f(2))

# 定义第二个函数：g(y) = sin(y)（输入输出均为MX类型）
y = MX.sym('y')
g = Function('g', [y], [sin(y)])
print(g(4))

# 组合为复合函数：h(x) = g(f(x)) = sin(x²)
h = Function('h', [x], [g(f(x))])  # 直接嵌套，基于MX变量传递
print(h(2))
```

调用方式与 `SX` 类似

## DM 

在 CasADi 中，DM（Dense Matrix，稠密矩阵）是一种数值型矩阵类型，与 SX（符号型）形成互补，主要用于存储和处理具体的数值数据（而非符号表达式），是连接符号计算与实际数值运算的关键载体。

### 数值计算

```python
# 创建DM矩阵（2×2矩阵）
c = ca.DM([[1.5, 2.5], [3.5, 4.5]])
print(c)

x = ca.DM([[2, 3], [4, 5]])
y = ca.DM([[1, 1], [1, 1]])

# 数值运算：矩阵加法
z = x + y  # 结果为 DM([[3,4],[5,6]])

# 数值运算：矩阵乘法
w = x @ y  # 结果为 DM([[5,5],[9,9]])
```

### 连接符号计算与数值求解

```python
# 1. 定义SX符号变量
x = ca.SX.sym('x')  # 符号变量x
y = ca.SX.sym('y')  # 符号变量y

# 2. 构建SX符号表达式
f = x**2 + y  # 表达式：f(x,y) = x² + y

# 3. 用Function编译表达式（定义输入和输出）
# 第一个参数是函数名，第二个参数是输入变量列表，第三个参数是输出表达式列表
f_func = ca.Function('f_func', [x, y], [f])

# 4. 定义要代入的数值（用DM类型存储）
x_val = ca.DM(2)   # x的数值：2
y_val = ca.DM(3)   # y的数值：3

# 5. 调用编译好的函数，传入数值计算结果
f_val = f_func(x_val, y_val)  # 计算 2² + 3 = 7

# 打印结果（f_val是DM类型，用.full()可转换为NumPy数组便于查看）
print("计算结果：", f_val)          # 输出：7
print("转换为NumPy数组：", f_val.full())  # 输出：[[7.]]
```