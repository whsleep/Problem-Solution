# 贝塞尔曲线

## 二阶贝塞尔曲线

给定 $3$ 个二维点 $\{P_1,P_2,P_3\}$

贝塞尔曲线通过两轮线性插值得到：

> 对于任意相邻两点 $P_i,P_{i+1}$ 构成的线段，
> 通过参数 $t$ 来确定线段 $P_iP_{i+1}$ 中唯一的一点 $Q_i$
> $$
> Q_i=(1-t)P_i+tP_{i+1}
> $$

- 第一轮

确定一个唯一参数 $t\in[0,1]$，计算得到所有相邻节点构成的插值点

$$
\begin{aligned}
Q_1&=(1-t)P_1+tP_2\\
Q_2&=(1-t)P_2+tP_3\\
\end{aligned}
$$

- 第二轮

仍然根据 $t\in[0,1]$，对 $Q_iQ_{i+1}$ 进行线性插值，得到最终插值后的 $S$

$$
\begin{aligned}
S&=(1-t)Q_1+tQ_2\\
\end{aligned}
$$

遍历 $t\in[0,1]$ 便可得到最终的插值点

代码如下

```python
import numpy as np
import matplotlib.pyplot as plt

def bezier_3points(P1, P2, P3, num_points=100):
    """
    计算三个控制点的贝塞尔曲线
    
    参数:
        P1, P2, P3: 三个控制点的坐标
        num_points: 生成的曲线上的点数量
        
    返回:
        贝塞尔曲线上的点列表
    """
    # 生成t从0到1的序列
    t_values = np.linspace(0, 1, num_points)
    curve = []
    
    for t in t_values:
        # 第一轮插值：计算Q1和Q2
        Q1 = (1 - t) * P1 + t * P2  # Q1 = (1-t)P1 + tP2
        Q2 = (1 - t) * P2 + t * P3  # Q2 = (1-t)P2 + tP3
        
        # 第二轮插值：计算S
        S = (1 - t) * Q1 + t * Q2   # S = (1-t)Q1 + tQ2
        
        curve.append(S)
    
    return np.array(curve)

# 定义三个控制点
P1 = np.array([0.1, 0.2])
P2 = np.array([0.5, 0.8])
P3 = np.array([0.9, 0.3])

# 计算贝塞尔曲线
curve = bezier_3points(P1, P2, P3)

# 绘制结果
plt.figure(figsize=(8, 6))

# 绘制控制点连线
plt.plot([P1[0], P2[0], P3[0]], [P1[1], P2[1], P3[1]], 'r--', label='connect control points')

# 绘制控制点及标记
plt.scatter([P1[0], P2[0], P3[0]], [P1[1], P2[1], P3[1]], c='red', s=100, zorder=5)
plt.text(P1[0]+0.02, P1[1]+0.02, 'P1', fontsize=12)
plt.text(P2[0]+0.02, P2[1]+0.02, 'P2', fontsize=12)
plt.text(P3[0]+0.02, P3[1]+0.02, 'P3', fontsize=12)

# 绘制贝塞尔曲线
plt.plot(curve[:, 0], curve[:, 1], 'b-', linewidth=2, label='bezier spline')

# 设置图表属性
plt.xlim(0, 1)
plt.ylim(0, 1)
plt.xlabel('X')
plt.ylabel('Y')
plt.legend()
plt.grid(True)
plt.axis('equal')
plt.show()

```



> $n$ 阶贝塞尔曲线由 $n+1$ 个控制点给出,但贝塞尔曲线每个控制点对曲线的影响不是局部的!!!

对于二阶贝塞尔曲线我们可以继续推导

$$
\begin{aligned}
S&=(1-t)Q_1+tQ_2\\
&=(1-t)[(1-t)P_1+tP_2]+t[(1-t)P_2+tP_3]\\
&=(1-t)^2P_1+t(1-t)P_2+t(1-t)P_2+t^2P_3\\
&=(1-t)^2P_1+2t(1-t)P_2+t^2P_3
\end{aligned}
$$

可以明显看到 $S$ 是一个多项式，每一点的控制权重是 $(t+(1-t))^2$ 展开后的各项

所以 $n$ 阶贝塞尔曲线表达式为

$$
S(t)=\sum_{k=0}^n B_{n,k}(t)P_k=\sum_{k=0}^n \frac{n!}{k!(n-k)!} (1-t)^{n-k}t^kP_k
$$

系数多项式为 [ $n$ 阶伯恩斯坦多项式（Bernstein polynomials)]

$$
B_{n,k}(t)=\frac{n!}{k!(n-k)!} (1-t)^{n-k}t^k
$$

通用代码 [1_Bézier.py](/Spline/code/1_Bézier.py)